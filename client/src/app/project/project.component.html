<ng-container *ngIf="!project">
  Loading project ...
</ng-container>

<ng-container *ngIf="project">
  <h1>{{getProjectName()}}</h1>
  <br/>
  <mat-tab-group>
    <mat-tab label="1. Project">
      <div class="vf-u-margin__top--xxl">
        <app-project-summary (tabChange)="projectTabChange($event)" [project]="project"></app-project-summary>
        <a class="vf-button vf-button--sm {{upload ? '' : 'vf-button--primary'}}" role="button"
           routerLink="/projects/{{project?.uuid?.uuid}}/{{selectedProjectTabKey}}">Edit Project</a>
        <button *ngIf="submissionEnvelopes && submissionEnvelopes.length === 0" mat-icon-button
                (click)="onDeleteProject()">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </div>
    </mat-tab>
    <mat-tab label="2. Experiment Template">
      <div class="vf-u-margin__top--xxl">
        <app-template-questionnaire></app-template-questionnaire>
      </div>
    </mat-tab>
    <mat-tab label="3. Upload">
      <div class="vf-u-margin__top--xxl">
        <button
          *ngIf="canSubmit(project)"
          type="button" class="vf-button vf-button--sm {{upload ? '' : 'vf-button--primary'}}"
          (click)="onSwitchUpload()">{{upload ? "Cancel" : "Submit to Project"}}</button>
      </div>
      <br/>
      <app-upload *ngIf="upload" [projectUuid]="projectUuid"></app-upload>
      <p style="text-align: center" *ngIf="!submissionEnvelopes || !submissionEnvelopes?.length">There are no
        submissions.</p>
      <div class="dashboard" *ngIf="!upload && submissionEnvelopes && submissionEnvelopes.length > 0">
        <h2>Previous Submissions</h2>
        <table>
          <thead class="thead-light">
          <tr>
            <th></th>
            <th></th>
            <th>Created</th>
            <th>Submission UUID</th>
            <th>Status</th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let submissionEnvelope of submissionEnvelopes">
            <td>
              <mat-icon [ngStyle]="{'color': 'lightgrey'}" *ngIf="submissionEnvelope['isUpdate']"
                        matTooltip="This is an update submission.">info
              </mat-icon>
            </td>
            <td><a href="{{submissionEnvelope['_links']['self']['href']}}" target="_blank" class="vf-link"
                   title="click to see Ingest API resource">
              <mat-icon [ngStyle]="{'color': 'lightgrey'}">link</mat-icon>
            </a></td>
            <td>{{submissionEnvelope.submissionDate | date: "medium"}}</td>
            <td>
              <a [routerLink]="['/submissions/detail']"
                 [queryParams]="{uuid:getSubmissionUuid(submissionEnvelope), project:project?.uuid?.uuid}"
                 class="text-info">{{getSubmissionUuid(submissionEnvelope)}}</a>
            </td>
            <td>
              <app-metadata-state [state]="submissionEnvelope.submissionState"></app-metadata-state>
            </td>
            <td>
              <button *ngIf="submissionEnvelope.open" mat-icon-button (click)="onDeleteSubmission(submissionEnvelope)">
                <mat-icon>delete_forever</mat-icon>
              </button>
            </td>
          </tr>
          <tr *ngIf="!submissionEnvelopes">
            <td>Loading your submissions...</td>
          </tr>
          <tr *ngIf="submissionEnvelopes && submissionEnvelopes.length === 0">
            <td>You do not currently have any submissions</td>
          </tr>
          </tbody>
        </table>
      </div>
    </mat-tab>
    <mat-tab label="4. View Metadata">
      <div class="vf-u-margin__top--xxl">
        <app-vf-tabs>
          <app-vf-tab title="Biomaterials">
            <app-data-table [dataSource]="biomaterialDataSource" [flatten]="true"></app-data-table>
          </app-vf-tab>
          <app-vf-tab title="Processes">
            <app-data-table [dataSource]="processDataSource" [flatten]="true"></app-data-table>
          </app-vf-tab>
          <app-vf-tab title="Protocols">
            <app-data-table [dataSource]="protocolDataSource" [flatten]="true"></app-data-table>
          </app-vf-tab>
        </app-vf-tabs>
      </div>
    </mat-tab>
    <mat-tab label="5. View Data">
      <div class="vf-u-margin__top--xxl">
        <app-data-table [dataSource]="fileDataSource" [flatten]="true">
        </app-data-table>
      </div>
    </mat-tab>
  </mat-tab-group>
</ng-container>
